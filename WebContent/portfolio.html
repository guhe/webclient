<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>组合</title>
<link rel="stylesheet" href="css/style.css" type="text/css" />
<script src="jquery-3.0.0.js"></script>
<script src="extends.js"></script>
<script>
	var portfolioId = $.getUrlVar("id");

	$(document).ready(function() {
		$("#stock_detail tbody tr").remove();

		$("#stock_detail caption a").attr("href", "trade.html?id=" + portfolioId);
		$("#holder_detail caption a").attr("href", "purchase_redeem.html?id=" + portfolioId);

		$.get({
			url : "rest/Portfolio/" + portfolioId,
			dataType : 'json',
			success : function(result) {
				$('title').text("组合-" + result["name"]);

				$("#netWorthPerUnit").html(result["netWorthPerUnit"].toFixed(4));
				$("#rateOfReturnYear").html(result["rateOfReturnYear"].toPercent(2));
				$("#netWorth").html(result["netWorth"].toFixed(0));
				$("#profit").html(result["profit"].toFixed(0));
				$("#cash").html(result["cash"].toFixed(0));
				$("#pb").html(result["pb"].toFixed(2));
				$("#pe").html(result["pe"].toFixed(1));
				$("#proportionOfStock").html(result["proportionOfStock"].toPercent(1));

				if (result["rateOfReturnYear"] < 0) {
					$("#rateOfReturnYear").css("color", "green");
				} else {
					$("#rateOfReturnYear").css("color", "red");
				}
			}
		});

		$.get({
			url : "rest/Portfolio/" + portfolioId + "/HoldingStock",
			dataType : 'json',
			success : function(result) {
				result.sort(function(a, b) {
					return b["proportion"] - a["proportion"];
				});
				$.each(result, function(key, row_data) {
					var row = $("<tr/>").appendTo($("#stock_detail tbody"));
					$("<td/>").html(row_data["name"] + row_data["code"]).appendTo(row); // 股票代码
					$("<td/>").html(row_data["amount"]).appendTo(row); // 数量
					$("<td/>").html(row_data["curPrice"].toFixed(2)).appendTo(row); // 价格
					$("<td/>").html(row_data["marketWorth"].toFixed(0)).appendTo(row); // 市值
					$("<td/>").html(row_data["estimatedCommission"].toFixed(2)).appendTo(row); //预计手续费
					$("<td/>").html(row_data["estimatedTax"].toFixed(2)).appendTo(row); //预计税费
					$("<td/>").html(row_data["netWorth"].toFixed(0)).appendTo(row); //净值
					$("<td/>").html(row_data["proportion"].toPercent(1)).appendTo(row); //占比
				});
			}
		});

		function appendRowToHolderTable(row_data) {
			var row = $("<tr/>").appendTo($("#holder_detail tbody"));
			$("<td/>").html(row_data["name"]).appendTo(row);
			$("<td/>").html(row_data["share"].toFixed(2)).appendTo(row);
			$("<td/>").html(row_data["netWorth"].toFixed(2)).appendTo(row);
			$("<td/>").html(row_data["totalInvestment"].toFixed(2)).appendTo(row);
			$("<td/>").html(row_data["rateOfReturn"].toPercent(1)).appendTo(row);
			$("<td/>").html(row_data["proportion"].toPercent(1)).appendTo(row);
		}

		$.get({
			url : "rest/Portfolio/" + portfolioId + "/Holder",
			dataType : 'json',
			success : function(result) {
				result.sort(function(a, b) {
					return b["name"] - a["name"];
				});
				var total = {
					"name" : "总计",
					"share" : 0,
					"netWorth" : 0,
					"totalInvestment" : 0,
					"rateOfReturn" : 0,
					"proportion" : 0
				};
				$.each(result, function(key, row_data) {
					appendRowToHolderTable(row_data);

					total["share"] += row_data["share"];
					total["netWorth"] += row_data["netWorth"];
					total["totalInvestment"] += row_data["totalInvestment"];
					total["proportion"] += row_data["proportion"];

				});
				total["rateOfReturn"] += total["netWorth"] / total["totalInvestment"] - 1;
				appendRowToHolderTable(total);
			}
		});

	});
</script>
</head>

<body>
	<div style="height: 50px"></div>
	<div id="global">
		<div>
			<table class="gmt">
				<tr>
					<td class="gmt-title">累计净值</td>
					<td class="gmt-title gmt-sp">年度收益率</td>
				</tr>
				<tr>
					<td id="netWorthPerUnit" class="gmt-value"></td>
					<td id="rateOfReturnYear" class="gmt-value gmt-sp"></td>
				</tr>
			</table>
		</div>
	</div>
	<div style="height: 5px"></div>
	<div id="global-more">
		<table class="gmt">
			<tr>
				<td class="gmt-detail-title">净资产</td>
				<td id="netWorth" class="gmt-detail-value"></td>
				<td class="gmt-detail-title">盈利</td>
				<td id="profit" class="gmt-detail-value"></td>
				<td class="gmt-detail-title">现金</td>
				<td id="cash" class="gmt-detail-value"></td>
			</tr>
			<tr>
				<td class="gmt-detail-title">PB</td>
				<td id="pb" class="gmt-detail-value"></td>
				<td class="gmt-detail-title">PE</td>
				<td id="pe" class="gmt-detail-value"></td>
				<td class="gmt-detail-title">仓位</td>
				<td id="proportionOfStock" class="gmt-detail-value"></td>
			</tr>
		</table>
	</div>
	<hr style="width: 800px" />
	<div id="stock_detail" class="detail">
		<table class="zebra">
			<caption>
				<span>持仓清单</span> <a href="#">交易</a>
			</caption>
			<thead>
				<tr>
					<th>证券名称/代码</th>
					<th>数量</th>
					<th>现价</th>
					<th>市值</th>
					<th>预计手续费</th>
					<th>预计税费</th>
					<th>净值</th>
					<th>占比</th>
				</tr>
			</thead>
			<tbody>
			</tbody>
		</table>
	</div>
	<hr style="width: 800px" />
	<div id="holder_detail" class="detail">
		<table class="zebra">
			<caption>
				<span>持有人清单</span> <a href="#">申赎</a>
			</caption>
			<thead>
				<tr>
					<th>名称</th>
					<th>份额</th>
					<th>净资产</th>
					<th>总投入</th>
					<th>收益率</th>
					<th>占比</th>
				</tr>
			</thead>
			<tbody>
			</tbody>
		</table>
	</div>
	<div id="log"></div>
</body>
</html>
